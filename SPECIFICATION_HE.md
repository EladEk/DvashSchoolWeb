# אפיון מעמיק - אתר בית ספר דב״ש

## תוכן עניינים
1. [סקירה כללית](#סקירה-כללית)
2. [סוגי משתמשים והרשאות](#סוגי-משתמשים-והרשאות)
3. [פעילויות לפי סוג משתמש](#פעילויות-לפי-סוג-משתמש)
4. [מערכת הפרלמנט](#מערכת-הפרלמנט)
5. [מערכת הניהול](#מערכת-הניהול)
6. [מבנה הנתונים](#מבנה-הנתונים)
7. [תכונות נוספות](#תכונות-נוספות)
8. [זרימות עבודה](#זרימות-עבודה)

---

## סקירה כללית

אתר בית ספר דב״ש הוא פלטפורמה דיגיטלית מקיפה לניהול תקשורת, דמוקרטיה ושיתוף פעולה בקהילת בית הספר. האתר מספק:

- **ניהול תוכן דינמי** - עריכת תוכן האתר ישירות מהדפדפן
- **מערכת פרלמנט דיגיטלית** - הצעת נושאים, דיונים והערות
- **ניהול משתמשים** - מערכת הרשאות מתקדמת
- **תמיכה דו-לשונית** - עברית ואנגלית
- **טפסי יצירת קשר** - יצירת קשר עם ועד ההורים והנהלת בית הספר

---

## סוגי משתמשים והרשאות

### 1. משתמש לא מחובר (Guest)
**תיאור:** כל מבקר באתר שאינו מחובר למערכת.

**הרשאות:**
- ✅ צפייה בתוכן הציבורי של האתר
- ✅ גלישה בין דפי האתר
- ✅ צפייה בשאלות נפוצות (FAQ)
- ✅ צפייה בנושאי פרלמנט מאושרים בלבד
- ❌ לא יכול להציע נושאים לפרלמנט
- ❌ לא יכול להוסיף הערות לדיונים
- ❌ לא יכול לגשת לאזורי ניהול

---

### 2. תלמיד (Student)
**תיאור:** תלמיד רשום במערכת.

**הרשאות:**
- ✅ כל ההרשאות של משתמש לא מחובר
- ✅ הצעת נושאים חדשים לפרלמנט
- ✅ הוספת הערות לנושאי פרלמנט מאושרים
- ✅ תגובה להערות (replies)
- ✅ עריכה ומחיקה של הערות שלו בלבד
- ✅ צפייה בהצעות שלו (ממתינות, מאושרות, נדחות)
- ❌ לא יכול לאשר/לדחות נושאים
- ❌ לא יכול לנהל תאריכי פרלמנט
- ❌ לא יכול לערוך תוכן האתר
- ❌ לא יכול לנהל משתמשים

**נתונים נדרשים:**
- שם משתמש (username)
- שם פרטי ושם משפחה
- תאריך לידה
- כיתה (א-יב)
- סיסמה

---

### 3. הורה (Parent)
**תיאור:** הורה רשום במערכת.

**הרשאות:**
- ✅ כל ההרשאות של תלמיד
- ✅ שליחת הודעות לוועד ההורים (טופס יצירת קשר)
- ✅ גישה למידע על ועד ההורים
- ❌ לא יכול לאשר/לדחות נושאים
- ❌ לא יכול לנהל תאריכי פרלמנט
- ❌ לא יכול לערוך תוכן האתר
- ❌ לא יכול לנהל משתמשים

**נתונים נדרשים:**
- שם משתמש (username)
- שם פרטי ושם משפחה
- תאריך לידה (אופציונלי)
- כיתה (אופציונלי)
- סיסמה

---

### 4. ועד (Committee)
**תיאור:** חבר ועד ההורים או ועדת הפרלמנט.

**הרשאות:**
- ✅ כל ההרשאות של הורה
- ✅ **ניהול מערכת הפרלמנט:**
  - יצירת תאריכי פרלמנט חדשים
  - פתיחה/סגירה של תאריכי פרלמנט
  - מחיקת תאריכי פרלמנט
  - אישור נושאים שהוצעו לפרלמנט
  - דחיית נושאים עם סיבת דחייה
  - שינוי סטטוס נושאים (מאושר/נדחה)
- ✅ **ניהול הערות בפרלמנט:**
  - עריכה ומחיקה של כל ההערות (לא רק שלו)
- ✅ גישה לדף ניהול הפרלמנט (`/admin/parliament`)
- ✅ גישה למצב עריכה (Admin Mode) לעריכת תוכן האתר
- ❌ לא יכול לערוך תרגומים
- ❌ לא יכול לנהל משתמשים

**נתונים נדרשים:**
- שם משתמש (username)
- שם פרטי ושם משפחה
- תאריך לידה (אופציונלי)
- סיסמה

---

### 5. עורך (Editor)
**תיאור:** עורך תוכן האתר.

**הרשאות:**
- ✅ כל ההרשאות של הורה
- ✅ **עריכת תוכן האתר:**
  - עריכת כל הטקסטים באתר (תרגומים)
  - עריכת תמונות
  - עריכת קישורים
  - שמירת שינויים ל-Firebase
  - ייצוא קבצי תרגום (JSON)
- ✅ גישה לדף ניהול התרגומים (`/admin/dashboard`)
- ✅ גישה למצב עריכה (Admin Mode)
- ❌ לא יכול לנהל משתמשים
- ❌ לא יכול לנהל את מערכת הפרלמנט
- ❌ לא יכול לאשר/לדחות נושאים

**נתונים נדרשים:**
- שם משתמש (username)
- שם פרטי ושם משפחה
- סיסמה

---

### 6. מנהל (Admin)
**תיאור:** מנהל מערכת מלא עם כל ההרשאות.

**הרשאות:**
- ✅ **כל ההרשאות של כל המשתמשים האחרים**
- ✅ **ניהול משתמשים:**
  - יצירת משתמשים חדשים
  - עריכת פרטי משתמשים
  - מחיקת משתמשים
  - שינוי תפקידים של משתמשים
  - איפוס סיסמאות
  - חיפוש וסינון משתמשים
- ✅ **ניהול מערכת הפרלמנט:**
  - כל ההרשאות של ועד
- ✅ **עריכת תוכן האתר:**
  - כל ההרשאות של עורך
- ✅ גישה לכל דפי הניהול
- ✅ גישה למצב עריכה (Admin Mode)

**נתונים נדרשים:**
- שם משתמש (username)
- שם פרטי ושם משפחה
- סיסמה

---

## פעילויות לפי סוג משתמש

### פעילויות ציבוריות (כל המשתמשים)

#### 1. גלישה באתר
- **דף בית** - צפייה בתוכן הראשי של האתר
- **שאלות נפוצות (FAQ)** - צפייה בשאלות ותשובות
- **יצירת קשר** - שליחת הודעות דרך טופס יצירת קשר
- **ועד ההורים** - צפייה במידע ושליחת הודעות
- **התאגדות הורים** - צפייה במידע על התאגדות ההורים

#### 2. מערכת הפרלמנט - צפייה
- צפייה בתאריכי פרלמנט פתוחים
- צפייה בנושאים מאושרים
- צפייה בנושאים מתאריכים סגורים
- צפייה בהערות על נושאים מאושרים

---

### פעילויות למשתמשים מחוברים

#### 1. ניהול פרופיל
- התחברות למערכת
- הרשמה למערכת
- התנתקות
- צפייה בפרופיל (שם משתמש, תפקיד)

#### 2. מערכת הפרלמנט - פעילות

**למשתמשים עם תפקיד: תלמיד, הורה, ועד, עורך, מנהל**

##### הצעת נושאים לפרלמנט
- מילוי טופס הצעת נושא:
  - בחירת תאריך פרלמנט
  - כותרת הנושא
  - תיאור מפורט
- שליחת ההצעה לאישור
- צפייה בהצעות הממתינות לאישור
- צפייה בהצעות שנדחו (כולל סיבת דחייה)

##### השתתפות בדיונים
- הוספת הערות לנושאים מאושרים
- תגובה להערות קיימות (replies)
- עריכה של הערות שלו
- מחיקה של הערות שלו
- צפייה בכל ההערות והתגובות

---

### פעילויות למשתמשים עם הרשאות ניהול

#### 1. ניהול מערכת הפרלמנט (ועד ומנהל)

##### ניהול תאריכי פרלמנט
- **יצירת תאריך חדש:**
  - הזנת כותרת תאריך
  - בחירת תאריך
  - התאריך נוצר במצב "פתוח" כברירת מחדל
- **פתיחה/סגירה של תאריך:**
  - החלפת מצב תאריך בין פתוח לסגור
  - תאריכים סגורים לא מאפשרים הצעת נושאים חדשים
- **מחיקת תאריך:**
  - מחיקת תאריך (לא מוחק נושאים קשורים)

##### ניהול נושאים
- **צפייה בתור לאישור:**
  - רשימת כל הנושאים הממתינים לאישור
  - מידע על כל נושא: כותרת, תיאור, יוצר, תאריך
- **אישור נושאים:**
  - אישור נושא והעברתו לרשימת הנושאים המאושרים
  - נושא מאושר מופיע לציבור
- **דחיית נושאים:**
  - דחיית נושא עם סיבת דחייה
  - נושא נדחה נשלח ליוצר עם הסיבה
- **שינוי סטטוס:**
  - שינוי סטטוס נושא בין מאושר/נדחה/ממתין

##### ניהול הערות
- עריכה של כל ההערות (לא רק שלו)
- מחיקה של כל ההערות (לא רק שלו)

#### 2. עריכת תוכן האתר (עורך ומנהל)

##### עריכת תרגומים
- **גישה לעורך התרגומים:**
  - דף ניהול מיוחד (`/admin/dashboard`)
  - מעבר בין עברית ואנגלית
- **עריכת טקסטים:**
  - עריכה של כל הטקסטים באתר
  - עריכה ישירה מתוך הדפדפן
  - תצוגה היררכית של כל המפתחות
- **שמירת שינויים:**
  - שמירה ל-Firebase Firestore
  - שמירה ל-localStorage כגיבוי
  - עדכון מיידי של האתר
- **ייצוא קבצים:**
  - ייצוא קבצי JSON מעודכנים
  - הורדה של `he.json` ו-`en.json`
  - אפשרות לעדכן את הקוד ב-Git

##### עריכת תוכן דינמי (Admin Mode)
- **הפעלת מצב עריכה:**
  - כפתור מיוחד בכותרת האתר
  - גישה רק למשתמשים מורשים (ועד, עורך, מנהל)
- **עריכת טקסטים ישירות:**
  - לחיצה על טקסטים לעריכה
  - שמירה מיידית
- **עריכת תמונות:**
  - העלאת תמונות חדשות
  - שימוש ב-ImageKit לניהול תמונות
  - החלפת תמונות קיימות
- **עריכת קישורים:**
  - שינוי קישורים באתר
  - הוספת קישורים חדשים

#### 3. ניהול משתמשים (מנהל בלבד)

##### יצירת משתמשים
- **טופס יצירת משתמש:**
  - שם משתמש (חייב להיות ייחודי)
  - שם פרטי ושם משפחה
  - תפקיד (תלמיד/הורה/ועד/עורך/מנהל)
  - תאריך לידה
  - כיתה (א-יב)
  - סיסמה (מוצפנת ב-SHA-256)
- **בדיקת כפילויות:**
  - בדיקה אוטומטית של שם משתמש קיים
  - מניעת יצירת משתמשים כפולים

##### עריכת משתמשים
- **עריכת פרטים:**
  - שינוי שם משתמש
  - שינוי שם פרטי/משפחה
  - שינוי תפקיד
  - שינוי תאריך לידה
  - שינוי כיתה
- **איפוס סיסמה:**
  - אפשרות לשנות סיסמה
  - סיסמה חדשה מוצפנת ב-SHA-256

##### מחיקת משתמשים
- מחיקת משתמש מהמערכת
- אימות לפני מחיקה

##### חיפוש וסינון
- חיפוש לפי שם, שם משתמש, תאריך לידה
- סינון לפי תפקיד
- תצוגה בטבלה מאורגנת

---

## מערכת הפרלמנט

### סקירה כללית
מערכת הפרלמנט היא פלטפורמה דיגיטלית לניהול תהליך הפרלמנט הדמוקרטי של בית הספר. המערכת מאפשרת:

1. **הצעת נושאים** - תלמידים והורים יכולים להציע נושאים לדיון
2. **אישור נושאים** - ועדת הפרלמנט מאשרת או דוחה נושאים
3. **דיונים** - משתמשים יכולים להוסיף הערות ולנהל דיונים
4. **ניהול תאריכים** - יצירה וניהול של תאריכי פרלמנט

### מבנה הנתונים

#### תאריכי פרלמנט (ParliamentDate)
```javascript
{
  id: String,                    // מזהה ייחודי
  title: String,                  // כותרת התאריך (למשל: "פרלמנט – 15 ספטמבר")
  date: Date,                     // תאריך הפרלמנט
  isOpen: Boolean,                // האם התאריך פתוח להצעות
  createdAt: Date,                 // תאריך יצירה
  createdByUid: String,           // מזהה יוצר
  createdByName: String            // שם יוצר
}
```

#### נושאי פרלמנט (ParliamentSubject)
```javascript
{
  id: String,                      // מזהה ייחודי
  title: String,                   // כותרת הנושא
  description: String,             // תיאור מפורט
  createdByUid: String,            // מזהה יוצר
  createdByName: String,           // שם יוצר
  createdAt: Date,                 // תאריך יצירה
  status: String,                  // 'pending' | 'approved' | 'rejected'
  statusReason: String,            // סיבת דחייה (אם נדחה)
  dateId: String,                  // מזהה תאריך הפרלמנט
  dateTitle: String,               // כותרת תאריך הפרלמנט
  notesCount: Number               // מספר הערות
}
```

#### הערות (ParliamentNote)
```javascript
{
  id: String,                      // מזהה ייחודי
  text: String,                    // תוכן ההערה
  createdAt: Date,                 // תאריך יצירה
  createdByUid: String,            // מזהה יוצר
  createdByName: String,           // שם יוצר
  subjectId: String,               // מזהה הנושא
  parentNoteId: String | null      // מזהה הערה אב (לתגובות)
}
```

### זרימת עבודה

#### 1. יצירת תאריך פרלמנט (ועד/מנהל)
1. כניסה לדף ניהול הפרלמנט (`/admin/parliament`)
2. מעבר לטאב "תאריכים"
3. לחיצה על "צור תאריך"
4. מילוי פרטים:
   - כותרת התאריך
   - תאריך הפרלמנט
5. שמירה
6. התאריך נוצר במצב "פתוח" כברירת מחדל

#### 2. הצעת נושא (תלמיד/הורה/ועד/עורך/מנהל)
1. כניסה לדף הפרלמנט (`/parliament`)
2. התחברות למערכת (אם לא מחובר)
3. מילוי טופס הצעת נושא:
   - בחירת תאריך פרלמנט
   - הזנת כותרת
   - הזנת תיאור
4. שליחת ההצעה
5. ההצעה מופיעה כ"ממתינה לאישור"

#### 3. אישור/דחיית נושא (ועד/מנהל)
1. כניסה לדף ניהול הפרלמנט (`/admin/parliament`)
2. מעבר לטאב "תור לאישור"
3. צפייה בנושאים הממתינים
4. בחירת פעולה:
   - **אישור:** לחיצה על "אשר" - הנושא עובר לרשימת הנושאים המאושרים
   - **דחייה:** לחיצה על "דחה" - הזנת סיבת דחייה - הנושא נדחה והסיבה נשלחת ליוצר

#### 4. דיון בנושא מאושר
1. כניסה לדף הפרלמנט (`/parliament`)
2. צפייה בנושאים מאושרים
3. לחיצה על "דיון / הערות" על נושא
4. צפייה בהערות קיימות
5. הוספת הערה חדשה או תגובה להערה קיימת
6. עריכה/מחיקה של הערות (לפי הרשאות)

---

## מערכת הניהול

### דף ניהול התרגומים (`/admin/dashboard`)

**גישה:** עורך ומנהל בלבד

**תכונות:**
- עריכת כל הטקסטים באתר
- מעבר בין עברית ואנגלית
- שמירה ל-Firebase
- ייצוא קבצי JSON
- תצוגה היררכית של כל המפתחות

**מבנה העורך:**
- תצוגה לפי מפתחות (keys)
- תמיכה במבנים היררכיים (nested objects)
- תמיכה במערכים (arrays)
- שדות טקסט מרובי שורות

### דף ניהול הפרלמנט (`/admin/parliament`)

**גישה:** ועד ומנהל בלבד

**תכונות:**
- ניהול תאריכי פרלמנט
- אישור/דחיית נושאים
- צפייה בכל הנושאים (מאושרים, נדחים, ממתינים)
- ניהול הערות

**טאבים:**
1. **תור לאישור** - נושאים הממתינים לאישור
2. **מאושרים** - נושאים שאושרו
3. **נדחו** - נושאים שנדחו
4. **תאריכים** - ניהול תאריכי פרלמנט

### דף ניהול משתמשים (בתוך `/admin/dashboard`)

**גישה:** מנהל בלבד

**תכונות:**
- יצירת משתמשים חדשים
- עריכת משתמשים קיימים
- מחיקת משתמשים
- חיפוש וסינון
- תצוגה בטבלה

---

## מבנה הנתונים

### משתמשים (appUsers)

```javascript
{
  id: String,                      // מזהה ייחודי (Firestore ID)
  username: String,                // שם משתמש (ייחודי)
  usernameLower: String,            // שם משתמש באותיות קטנות (לחיפוש)
  firstName: String,               // שם פרטי
  lastName: String,                // שם משפחה
  role: String,                    // 'admin' | 'editor' | 'committee' | 'parent' | 'student'
  birthday: String,                // תאריך לידה (YYYY-MM-DD)
  classId: String,                 // כיתה (א-יב)
  passwordHash: String,            // סיסמה מוצפנת (SHA-256)
  createdAt: Date,                 // תאריך יצירה
  email: String,                   // אימייל (אופציונלי)
  uid: String                      // מזהה משתמש (אופציונלי)
}
```

### תרגומים (translations)

```javascript
{
  he: Object,                      // כל התרגומים בעברית
  en: Object                       // כל התרגומים באנגלית
}
```

**מבנה התרגומים:**
- מבנה היררכי של מפתחות
- תמיכה במערכים
- כל הטקסטים באתר נמצאים כאן

---

## תכונות נוספות

### 1. מערכת תרגומים דו-לשונית
- תמיכה מלאה בעברית ואנגלית
- מעבר דינמי בין שפות
- תמיכה ב-RTL (עברית) ו-LTR (אנגלית)
- עריכת תרגומים ישירות מהדפדפן

### 2. מצב עריכה (Admin Mode)
- הפעלה/כיבוי של מצב עריכה
- עריכה ישירה של תוכן באתר
- עריכת תמונות עם ImageKit
- עריכת קישורים

### 3. מערכת אימות
- התחברות עם שם משתמש וסיסמה
- הרשמה למערכת
- ניהול סשן (session)
- בדיקת הרשאות בזמן אמת

### 4. טפסי יצירת קשר
- **טופס יצירת קשר כללי** - שליחת הודעות כלליות
- **טופס ועד ההורים** - שליחת הודעות ספציפיות לוועד
- שימוש ב-EmailJS לשליחת אימיילים

### 5. מערכת תמונות
- שימוש ב-ImageKit לניהול תמונות
- העלאת תמונות
- עריכת תמונות
- אופטימיזציה אוטומטית

### 6. תמיכה במובייל
- עיצוב רספונסיבי
- תמיכה במסכים קטנים
- ניווט מותאם למובייל

---

## זרימות עבודה

### זרימת התחברות

1. **משתמש לא מחובר:**
   - גלישה באתר
   - לחיצה על "התחבר / הירשם" בפרלמנט
   - מעבר לדף התחברות

2. **התחברות:**
   - הזנת שם משתמש וסיסמה
   - בדיקת פרטים מול Firebase
   - יצירת סשן
   - החזרה לדף הפרלמנט

3. **הרשמה:**
   - מילוי טופס הרשמה:
     - שם משתמש
     - סיסמה
     - שם פרטי ושם משפחה
     - תפקיד (תלמיד/הורה)
     - תאריך לידה (אופציונלי)
     - כיתה (אופציונלי)
   - בדיקת שם משתמש ייחודי
   - יצירת משתמש ב-Firebase
   - הצפנת סיסמה
   - התחברות אוטומטית

### זרימת הצעת נושא לפרלמנט

1. **משתמש מחובר** נכנס לדף הפרלמנט
2. **משתמש** ממלא טופס הצעת נושא:
   - בוחר תאריך פרלמנט
   - כותב כותרת
   - כותב תיאור
3. **המערכת** שומרת את הנושא במצב "ממתין"
4. **משתמש** רואה את הנושא ברשימת "ההצעות שלי הממתינות"
5. **ועד/מנהל** רואה את הנושא ב"תור לאישור"
6. **ועד/מנהל** מאשר או דוחה:
   - **אם מאשר:** הנושא מופיע ברשימת הנושאים המאושרים
   - **אם דוחה:** הנושא מופיע ברשימת "ההצעות שלי שנדחו" עם סיבת דחייה

### זרימת דיון בנושא

1. **משתמש** רואה נושא מאושר בפרלמנט
2. **משתמש** לוחץ על "דיון / הערות"
3. **פתיחת חלון דיון** עם:
   - פרטי הנושא
   - רשימת הערות קיימות
   - טופס הוספת הערה
4. **משתמש** מוסיף הערה או מגיב להערה קיימת
5. **הערה נשמרת** ומתעדכנת בזמן אמת
6. **משתמשים אחרים** רואים את ההערה החדשה

### זרימת עריכת תוכן

1. **עורך/מנהל** מפעיל "מצב עריכה" (Admin Mode)
2. **כפתורי עריכה** מופיעים ליד כל תוכן
3. **לחיצה על כפתור עריכה**:
   - לטקסט: פתיחת עורך טקסט
   - לתמונה: פתיחת עורך תמונות
   - לקישור: פתיחת עורך קישורים
4. **עריכת התוכן** ושמירה
5. **התוכן מתעדכן** מיידית באתר

### זרימת ניהול משתמשים

1. **מנהל** נכנס לדף ניהול (`/admin/dashboard`)
2. **מעבר לטאב "ניהול משתמשים"**
3. **יצירת משתמש חדש:**
   - מילוי טופס
   - בדיקת שם משתמש ייחודי
   - הצפנת סיסמה
   - שמירה ב-Firebase
4. **עריכת משתמש:**
   - לחיצה על "ערוך"
   - שינוי פרטים
   - שמירה
5. **מחיקת משתמש:**
   - לחיצה על "מחק"
   - אימות
   - מחיקה מ-Firebase

---

## אבטחה והרשאות

### מנגנון בדיקת הרשאות

המערכת משתמשת במספר שכבות בדיקה:

1. **בדיקת סשן:**
   - בדיקה ראשונית של תפקיד בסשן
   - מהיר אך פחות מאובטח

2. **בדיקת Firebase:**
   - בדיקה מול מסד הנתונים
   - חיפוש לפי: uid, email, usernameLower
   - בדיקה בשתי אוספים: `appUsers` ו-`users`

3. **בדיקה מתמשכת:**
   - בדיקה כל 5 שניות
   - עדכון אוטומטי של הרשאות

### הגנות

- **הצפנת סיסמאות:** SHA-256
- **בדיקת הרשאות בצד הלקוח והשרת**
- **הגנה על נתיבים:** שימוש ב-`RequireRole` ו-`AdminRoute`

---

## מסקנות

אתר בית ספר דב״ש הוא פלטפורמה מקיפה המספקת:

✅ **ניהול דמוקרטי** - מערכת פרלמנט דיגיטלית מלאה
✅ **תקשורת** - טפסי יצירת קשר ודיונים
✅ **ניהול תוכן** - עריכה דינמית של כל התוכן
✅ **ניהול משתמשים** - מערכת הרשאות מתקדמת
✅ **גישה דו-לשונית** - תמיכה מלאה בעברית ואנגלית
✅ **חוויית משתמש** - ממשק ידידותי ונוח

המערכת תומכת בכל סוגי המשתמשים בקהילת בית הספר ומאפשרת תקשורת, שיתוף פעולה וניהול דמוקרטי יעיל.
