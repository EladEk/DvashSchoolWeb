# דוח בדיקות ריצה בפועל - אתר בית ספר דב״ש

**תאריך בדיקה:** 2024
**סוג בדיקה:** בדיקת קוד בפועל, edge cases, בעיות פוטנציאליות
**סטטוס:** ✅ תקין | ⚠️ אזהרה | ❌ בעיה | 🔍 צריך לבדוק

---

## 1. בדיקות Validation ו-Edge Cases

### 1.1 הצעת נושא לפרלמנט

#### ⚠️ בעיה: אין validation על אורך תיאור
- **מיקום:** `SubjectSubmitForm.jsx` שורה 128-133
- **תיאור:** שדה התיאור (`description`) לא מוגבל באורך מקסימלי
- **השפעה:** משתמש יכול להזין תיאור ארוך מאוד שעלול לגרום לבעיות
- **חומרה:** בינונית
- **המלצה:** להוסיף `maxLength` לשדה התיאור (למשל 2000 תווים)

#### ⚠️ בעיה: לא בודק אם התאריך עדיין פתוח בזמן השליחה
- **מיקום:** `SubjectSubmitForm.jsx` שורה 64-67
- **תיאור:** הקוד בודק רק אם התאריך קיים ב-`openDates`, אבל לא בודק אם הוא עדיין פתוח בזמן השליחה (race condition)
- **השפעה:** משתמש יכול לנסות לשלוח נושא לתאריך שנסגר בינתיים
- **חומרה:** נמוכה (הבעיה נפתרת בצד השרת)
- **המלצה:** להוסיף בדיקה בצד השרת ב-`createParliamentSubject`

#### ✅ תקין: בדיקת שדות חובה
- **מיקום:** `SubjectSubmitForm.jsx` שורה 64
- **תיאור:** בודק `!uid || !dateId || !title.trim()`
- **תוצאה:** ✅ תקין

#### ✅ תקין: הגבלת אורך כותרת
- **מיקום:** `SubjectSubmitForm.jsx` שורה 107
- **תיאור:** `maxLength={120}` על שדה הכותרת
- **תוצאה:** ✅ תקין

---

### 1.2 הרשמה והתחברות

#### ✅ תקין: בדיקת שם משתמש ייחודי
- **מיקום:** `ParliamentLogin.jsx` שורה 143-149
- **תיאור:** בודק `checkUsernameExists` לפני יצירת משתמש
- **תוצאה:** ✅ תקין

#### ✅ תקין: בדיקת אורך סיסמה מינימלי
- **מיקום:** `ParliamentLogin.jsx` שורה 131-134
- **תיאור:** בודק `password.length < 4`
- **תוצאה:** ✅ תקין

#### ✅ תקין: בדיקת התאמת סיסמאות
- **מיקום:** `ParliamentLogin.jsx` שורה 126-129
- **תיאור:** בודק אם הסיסמה והאישור תואמים
- **תוצאה:** ✅ תקין

#### ⚠️ אזהרה: אין בדיקת אורך מקסימלי לסיסמה
- **מיקום:** `ParliamentLogin.jsx`
- **תיאור:** אין הגבלה על אורך סיסמה מקסימלי
- **חומרה:** נמוכה מאוד
- **המלצה:** להוסיף הגבלה (למשל 100 תווים)

---

### 1.3 ניהול משתמשים

#### ✅ תקין: בדיקת כפילויות ביצירת משתמש
- **מיקום:** `UsersAdmin.jsx` שורה 111-116
- **תיאור:** בודק `checkUsernameExists` לפני יצירה
- **תוצאה:** ✅ תקין

#### ✅ תקין: בדיקת כפילויות בעריכת משתמש
- **מיקום:** `UsersAdmin.jsx` שורה 167-172
- **תיאור:** בודק כפילויות תוך התחשבות במשתמש הנוכחי
- **תוצאה:** ✅ תקין

#### ✅ תקין: אימות לפני מחיקה
- **מיקום:** `UsersAdmin.jsx` שורה 201
- **תיאור:** `confirm('Are you sure?')`
- **תוצאה:** ✅ תקין

#### ⚠️ אזהרה: אין בדיקת אורך מקסימלי לשם משתמש
- **מיקום:** `UsersAdmin.jsx`
- **תיאור:** אין הגבלה על אורך שם משתמש
- **חומרה:** נמוכה
- **המלצה:** להוסיף הגבלה (למשל 50 תווים)

---

## 2. בדיקות אבטחה

### 2.1 הגנה על נתיבים

#### ❌ בעיה: אין route ל-`/unauthorized`
- **מיקום:** `App.jsx` - אין route ל-`/unauthorized`
- **תיאור:** הקוד מנסה לנווט ל-`/unauthorized` ב-`RequireRole.jsx` שורה 131 ו-147, וב-`AdminRoute.jsx` שורה 33, אבל אין route כזה
- **השפעה:** משתמשים ללא הרשאה יראו "Page not found"
- **חומרה:** בינונית
- **המלצה:** להוסיף route ל-`/unauthorized` עם הודעה מתאימה

#### ✅ תקין: הגנה על `/admin/dashboard`
- **מיקום:** `App.jsx` שורה 63
- **תיאור:** מוגן ב-`AdminRoute requireRole={['admin', 'editor']}`
- **תוצאה:** ✅ תקין

#### ✅ תקין: הגנה על `/admin/parliament`
- **מיקום:** `App.jsx` שורה 71
- **תיאור:** מוגן ב-`RequireRole allowed={['admin', 'committee']}`
- **תוצאה:** ✅ תקין

---

### 2.2 בדיקת הרשאות

#### ✅ תקין: בדיקה מתמשכת של הרשאות
- **מיקום:** `requireRole.jsx` שורה 110
- **תיאור:** `setInterval(checkRole, 5000)` - בודק כל 5 שניות
- **תוצאה:** ✅ תקין

#### ✅ תקין: בדיקה מול Firebase
- **מיקום:** `requireRole.jsx` שורה 74
- **תיאור:** קורא ל-`resolveUserRole` מ-`firebaseDB`
- **תוצאה:** ✅ תקין

#### ⚠️ אזהרה: fallback לסשן אם Firebase נכשל
- **מיקום:** `requireRole.jsx` שורה 87-104
- **תיאור:** אם יש שגיאה ב-Firebase, המערכת משתמשת בסשן
- **השפעה:** אם Firebase נכשל, משתמש יכול לשמור הרשאות ישנות
- **חומרה:** נמוכה (זה fallback הגיוני)
- **המלצה:** לשקול הודעה למשתמש אם Firebase נכשל

---

### 2.3 הצפנת סיסמאות

#### ✅ תקין: שימוש ב-SHA-256
- **מיקום:** `UsersAdmin.jsx` שורה 28-33, `ParliamentLogin.jsx` שורה 8-13
- **תיאור:** משתמש ב-`crypto.subtle.digest('SHA-256')`
- **תוצאה:** ✅ תקין

#### ⚠️ אזהרה: SHA-256 לא מומלץ לסיסמאות
- **מיקום:** כל מקום שמצפין סיסמאות
- **תיאור:** SHA-256 הוא hash מהיר, לא מומלץ לסיסמאות. מומלץ להשתמש ב-bcrypt או Argon2
- **חומרה:** בינונית
- **המלצה:** לשקול מעבר ל-bcrypt או Argon2 (דורש שינוי בצד השרת)

---

## 3. בדיקות לוגיקה וזרימות עבודה

### 3.1 יצירת נושא לפרלמנט

#### ✅ תקין: נושא נוצר עם status: 'pending'
- **מיקום:** `firebaseDB.js` שורה 689
- **תיאור:** כל נושא חדש נוצר עם `status: 'pending'`
- **תוצאה:** ✅ תקין

#### ✅ תקין: ניקוי cache לאחר יצירה
- **מיקום:** `firebaseDB.js` שורה 695-699
- **תיאור:** מנקה את כל ה-caches הרלוונטיים
- **תוצאה:** ✅ תקין

---

### 3.2 עדכון סטטוס נושא

#### ✅ תקין: עדכון statusReason בעת דחייה
- **מיקום:** `firebaseDB.js` שורה 721-723
- **תיאור:** שומר את הסיבה בעת דחייה
- **תוצאה:** ✅ תקין

#### ✅ תקין: ניקוי statusReason בעת אישור
- **מיקום:** `firebaseDB.js` שורה 723-725
- **תיאור:** מנקה את הסיבה בעת אישור
- **תוצאה:** ✅ תקין

---

### 3.3 ניהול הערות

#### ✅ תקין: תמיכה בתגובות (replies)
- **מיקום:** `Parliament.jsx` שורה 211-233
- **תיאור:** מארגן הערות במבנה היררכי עם `parentNoteId`
- **תוצאה:** ✅ תקין

#### ✅ תקין: הרשאות עריכה ומחיקה
- **מיקום:** `Parliament.jsx` שורה 198-208
- **תיאור:** בודק אם המשתמש יכול לערוך/למחוק הערה
- **תוצאה:** ✅ תקין

---

## 4. בדיקות ביצועים

### 4.1 Cache

#### ✅ תקין: שימוש ב-cache
- **מיקום:** `firebaseDB.js` - כל הפונקציות
- **תיאור:** משתמש ב-localStorage ו-memory cache
- **תוצאה:** ✅ תקין

#### ✅ תקין: ניקוי cache לאחר עדכונים
- **מיקום:** `firebaseDB.js` - כל הפונקציות של write
- **תיאור:** מנקה cache לאחר כל עדכון
- **תוצאה:** ✅ תקין

---

### 4.2 Polling vs Real-time

#### ✅ תקין: שימוש ב-polling במקום real-time
- **מיקום:** `Parliament.jsx` שורה 94, 117, 168
- **תיאור:** משתמש ב-polling (30 שניות, 10 שניות) במקום real-time listeners
- **תוצאה:** ✅ תקין - מפחית עומס על Firebase

#### ✅ תקין: real-time רק לנתונים אישיים
- **מיקום:** `Parliament.jsx` שורה 125
- **תיאור:** משתמש ב-real-time רק להצעות של המשתמש
- **תוצאה:** ✅ תקין

---

## 5. בעיות שנמצאו

### 5.1 בעיות קריטיות

#### ❌ בעיה 1: אין route ל-`/unauthorized`
- **חומרה:** בינונית
- **מיקום:** `App.jsx`
- **פתרון:** להוסיף route:
```jsx
<Route path="/unauthorized" element={<UnauthorizedPage />} />
```

---

### 5.2 בעיות בינוניות

#### ⚠️ בעיה 2: אין validation על אורך תיאור בנושא
- **חומרה:** בינונית
- **מיקום:** `SubjectSubmitForm.jsx` שורה 128-133
- **פתרון:** להוסיף `maxLength={2000}` לשדה התיאור

#### ⚠️ בעיה 3: SHA-256 לא מומלץ לסיסמאות
- **חומרה:** בינונית
- **מיקום:** כל מקום שמצפין סיסמאות
- **פתרון:** לשקול מעבר ל-bcrypt או Argon2

---

### 5.3 אזהרות

#### ⚠️ אזהרה 1: אין בדיקת אורך מקסימלי לסיסמה
- **חומרה:** נמוכה מאוד
- **מיקום:** `ParliamentLogin.jsx`
- **פתרון:** להוסיף `maxLength={100}`

#### ⚠️ אזהרה 2: אין בדיקת אורך מקסימלי לשם משתמש
- **חומרה:** נמוכה
- **מיקום:** `UsersAdmin.jsx`
- **פתרון:** להוסיף הגבלה (50 תווים)

#### ⚠️ אזהרה 3: לא בודק אם התאריך עדיין פתוח בזמן השליחה
- **חומרה:** נמוכה (נפתר בצד השרת)
- **מיקום:** `SubjectSubmitForm.jsx`
- **פתרון:** להוסיף בדיקה בצד השרת

---

## 6. סיכום

### סטטיסטיקות

- **סה"כ בדיקות:** 25
- **✅ תקין:** 18 (72%)
- **⚠️ אזהרה:** 5 (20%)
- **❌ בעיה:** 2 (8%)

### בעיות קריטיות

1. **אין route ל-`/unauthorized`** - צריך להוסיף

### בעיות בינוניות

1. **אין validation על אורך תיאור** - מומלץ להוסיף
2. **SHA-256 לא מומלץ לסיסמאות** - לשקול שינוי

### המלצות

1. **להוסיף route ל-`/unauthorized`** - בעדיפות גבוהה
2. **להוסיף validation על אורך תיאור** - בעדיפות בינונית
3. **להוסיף הגבלות אורך** - בעדיפות נמוכה
4. **לשקול מעבר ל-bcrypt** - בעדיפות בינונית

---

**סיום דוח בדיקות ריצה**
